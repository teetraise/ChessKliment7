<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ôüÔ∏è –û–Ω–ª–∞–π–Ω —à–∞—Ö–º–∞—Ç—ã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 600px 1fr;
            grid-template-rows: auto 1fr auto;
            gap: 20px;
            min-height: 100vh;
        }

        .header {
            grid-column: 1 / -1;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .connection-panel, .chess-board-container, .chat-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .connection-panel, .chat-panel {
            height: fit-content;
        }

        .chess-board-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .chess-board {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            border: 3px solid #8B4513;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .chess-square {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            user-select: none;
        }

        .chess-square:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .chess-square.white {
            background-color: #f0d9b5;
        }

        .chess-square.black {
            background-color: #b58863;
        }

        .chess-square.selected {
            background-color: #ffeb3b !important;
            box-shadow: inset 0 0 10px rgba(255, 193, 7, 0.8);
        }

        .chess-square.possible-move {
            background-color: #4caf50 !important;
            opacity: 0.8;
        }

        .avatar-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: #ff5722;
            border-radius: 50%;
            border: 1px solid white;
            z-index: 5;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            margin: 5px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .status-indicator {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
        }

        .status-connected {
            background: #4caf50;
            color: white;
        }

        .status-disconnected {
            background: #f44336;
            color: white;
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            background: #fafafa;
        }

        .chat-message {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            word-wrap: break-word;
        }

        .chat-message.system {
            background: #e3f2fd;
            color: #1976d2;
        }

        .chat-message.event {
            background: #fff3e0;
            color: #f57c00;
            font-weight: bold;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .moves-history {
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            background: #fafafa;
            margin-top: 15px;
        }

        .move-item {
            padding: 5px;
            margin: 2px 0;
            background: white;
            border-radius: 4px;
            font-size: 14px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success { background: #4caf50; }
        .notification.error { background: #f44336; }
        .notification.info { background: #2196f3; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ôüÔ∏è –û–Ω–ª–∞–π–Ω —à–∞—Ö–º–∞—Ç—ã</h1>
            <p>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ7 - UDP, TCP, WebSocket</p>
        </div>

        <div class="connection-panel">
            <h3>üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É</h3>
            
            <div class="status-indicator" id="connectionStatus">
                <span class="status-disconnected">‚ùå –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</span>
            </div>

            <div class="input-group">
                <label for="playerName">üë§ –í–∞—à–µ –∏–º—è:</label>
                <input type="text" id="playerName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" value="–ò–≥—Ä–æ–∫1">
            </div>

            <div class="input-group">
                <label for="serverHost">üåê –ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞:</label>
                <input type="text" id="serverHost" placeholder="localhost" value="localhost">
            </div>

            <div class="input-group">
                <label for="wsPort">üåê WebSocket –ø–æ—Ä—Ç:</label>
                <input type="number" id="wsPort" placeholder="8082" value="8082">
            </div>

            <button class="btn" id="connectBtn" onclick="toggleConnection()">
                üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
            </button>

            <div class="moves-history" id="movesHistory">
                <strong>üìú –ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤:</strong>
                <div id="movesList"></div>
            </div>
        </div>

        <div class="chess-board-container">
            <div style="text-align: center; margin-bottom: 15px;">
                <button class="btn" onclick="resetBoard()" id="resetBtn">
                    üîÑ –°–±—Ä–æ—Å–∏—Ç—å –¥–æ—Å–∫—É
                </button>
                <button class="btn" onclick="clearSelection()" id="clearBtn">
                    ‚ú® –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä
                </button>
            </div>

            <div class="chess-board" id="chessBoard">
                <!-- –ü–æ–ª—è —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
            </div>

            <div style="text-align: center; margin-top: 15px;">
                <p><strong>üéØ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</strong></p>
                <p>1Ô∏è‚É£ –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Ñ–∏–≥—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                <p>2Ô∏è‚É£ –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Ü–µ–ª–µ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è —Ö–æ–¥–∞</p>
                <p>3Ô∏è‚É£ –ö—Ä–∞—Å–Ω—ã–µ —Ç–æ—á–∫–∏ - –ø–æ–∑–∏—Ü–∏–∏ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤</p>
            </div>
        </div>

        <div class="chat-panel">
            <h3>üí¨ –ß–∞—Ç –∏ —Å–æ–±—ã—Ç–∏—è</h3>
            
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message system">
                    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –æ–Ω–ª–∞–π–Ω —à–∞—Ö–º–∞—Ç—ã! –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã.
                </div>
            </div>

            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." disabled>
                <button class="btn" onclick="sendChatMessage()" disabled id="sendChatBtn">
                    üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <script>
        console.log('üéÆ –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞—Ö–º–∞—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞...');

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let isConnected = false;
        let sessionId = '';
        let playerName = '';
        let webSocket = null;
        let selectedSquare = null;
        let gameBoard = {};
        let moveHistory = [];

        // –ù–∞—á–∞–ª—å–Ω–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–∏–≥—É—Ä
        const INITIAL_BOARD = {
            'a8': '‚ôú', 'b8': '‚ôû', 'c8': '‚ôù', 'd8': '‚ôõ', 'e8': '‚ôö', 'f8': '‚ôù', 'g8': '‚ôû', 'h8': '‚ôú',
            'a7': '‚ôü', 'b7': '‚ôü', 'c7': '‚ôü', 'd7': '‚ôü', 'e7': '‚ôü', 'f7': '‚ôü', 'g7': '‚ôü', 'h7': '‚ôü',
            'a2': '‚ôô', 'b2': '‚ôô', 'c2': '‚ôô', 'd2': '‚ôô', 'e2': '‚ôô', 'f2': '‚ôô', 'g2': '‚ôô', 'h2': '‚ôô',
            'a1': '‚ôñ', 'b1': '‚ôò', 'c1': '‚ôó', 'd1': '‚ôï', 'e1': '‚ôî', 'f1': '‚ôó', 'g1': '‚ôò', 'h1': '‚ôñ'
        };

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID —Å–µ—Å—Å–∏–∏
        function generateSessionId() {
            return Math.random().toString(36).substring(2, 10);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —à–∞—Ö–º–∞—Ç–Ω–æ–π –¥–æ—Å–∫–∏
        function createChessBoard() {
            const board = document.getElementById('chessBoard');
            board.innerHTML = '';

            for (let row = 8; row >= 1; row--) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    const file = String.fromCharCode(97 + col); // a-h
                    const squareId = file + row;
                    
                    square.className = `chess-square ${(row + col) % 2 === 0 ? 'black' : 'white'}`;
                    square.id = squareId;
                    square.onclick = () => handleSquareClick(squareId);
                    
                    board.appendChild(square);
                }
            }
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
        function setupInitialPosition() {
            // –û—á–∏—â–∞–µ–º –¥–æ—Å–∫—É
            document.querySelectorAll('.chess-square').forEach(square => {
                square.textContent = '';
                square.classList.remove('selected', 'possible-move');
            });

            // –†–∞—Å—Å—Ç–∞–≤–ª—è–µ–º —Ñ–∏–≥—É—Ä—ã
            for (const [square, piece] of Object.entries(INITIAL_BOARD)) {
                const element = document.getElementById(square);
                if (element) {
                    element.textContent = piece;
                }
            }

            gameBoard = { ...INITIAL_BOARD };
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –ø–æ–ª—é
        function handleSquareClick(squareId) {
            if (!isConnected) {
                showNotification('–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –∏–≥—Ä—ã!', 'error');
                return;
            }

            const square = document.getElementById(squareId);
            
            if (selectedSquare === null) {
                // –í—ã–±–æ—Ä —Ñ–∏–≥—É—Ä—ã
                if (square.textContent && square.textContent.trim() !== '') {
                    selectedSquare = squareId;
                    square.classList.add('selected');
                }
            } else {
                // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ö–æ–¥–∞
                if (selectedSquare === squareId) {
                    // –û—Ç–º–µ–Ω–∞ –≤—ã–±–æ—Ä–∞
                    clearSelection();
                } else {
                    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ö–æ–¥–∞
                    makeMove(selectedSquare, squareId);
                }
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è
        function clearSelection() {
            document.querySelectorAll('.chess-square').forEach(square => {
                square.classList.remove('selected', 'possible-move');
            });
            selectedSquare = null;
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ö–æ–¥–∞
        function makeMove(from, to) {
            const piece = gameBoard[from];
            if (!piece) return;

            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            gameBoard[to] = piece;
            delete gameBoard[from];

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
            document.getElementById(from).textContent = '';
            document.getElementById(to).textContent = piece;

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ö–æ–¥
            if (isConnected) {
                sendMove(from, to, piece);
            }
            
            clearSelection();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é —Ö–æ–¥–æ–≤
            addMoveToHistory(playerName, from, to, piece);
        }

        // –°–±—Ä–æ—Å –¥–æ—Å–∫–∏
        function resetBoard() {
            setupInitialPosition();
            clearSelection();
            showNotification('–î–æ—Å–∫–∞ —Å–±—Ä–æ—à–µ–Ω–∞', 'info');
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
        async function connect() {
            const nameInput = document.getElementById('playerName');
            const hostInput = document.getElementById('serverHost');
            const wsPortInput = document.getElementById('wsPort');
            
            playerName = nameInput.value.trim();
            const host = hostInput.value.trim() || 'localhost';
            const wsPort = wsPortInput.value.trim() || '8082';

            if (!playerName) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è!', 'error');
                return;
            }

            try {
                // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ WebSocket
                const wsUrl = `ws://${host}:${wsPort}/?sessionId=${sessionId}`;
                webSocket = new WebSocket(wsUrl);

                webSocket.onopen = () => {
                    isConnected = true;
                    updateConnectionStatus();
                    
                    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                    sendMessage({
                        type: 'register',
                        sessionId: sessionId,
                        playerName: playerName
                    });

                    showNotification('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É!', 'success');
                    addChatMessage('–°–∏—Å—Ç–µ–º–∞', `–ü–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É –∫–∞–∫ ${playerName}`, 'system');
                };

                webSocket.onmessage = (event) => {
                    handleMessage(event.data);
                };

                webSocket.onclose = () => {
                    isConnected = false;
                    updateConnectionStatus();
                    showNotification('–û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞', 'error');
                    addChatMessage('–°–∏—Å—Ç–µ–º–∞', '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º —Ä–∞–∑–æ—Ä–≤–∞–Ω–æ', 'system');
                };

                webSocket.onerror = (error) => {
                    showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                    addChatMessage('–°–∏—Å—Ç–µ–º–∞', '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'system');
                };

            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        function disconnect() {
            if (webSocket) {
                webSocket.close();
            }
            isConnected = false;
            updateConnectionStatus();
            addChatMessage('–°–∏—Å—Ç–µ–º–∞', '–û—Ç–∫–ª—é—á–µ–Ω –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞', 'system');
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        async function toggleConnection() {
            if (isConnected) {
                disconnect();
            } else {
                await connect();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function updateConnectionStatus() {
            const statusDiv = document.getElementById('connectionStatus');
            const connectBtn = document.getElementById('connectBtn');
            const chatInput = document.getElementById('chatInput');
            const sendChatBtn = document.getElementById('sendChatBtn');

            if (isConnected) {
                statusDiv.innerHTML = '<span class="status-connected">‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω</span>';
                connectBtn.textContent = 'üîå –û—Ç–∫–ª—é—á–∏—Ç—å—Å—è';
                chatInput.disabled = false;
                sendChatBtn.disabled = false;
            } else {
                statusDiv.innerHTML = '<span class="status-disconnected">‚ùå –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</span>';
                connectBtn.textContent = 'üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è';
                chatInput.disabled = true;
                sendChatBtn.disabled = true;
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket
        function sendMessage(message) {
            if (webSocket && webSocket.readyState === WebSocket.OPEN) {
                try {
                    webSocket.send(JSON.stringify(message));
                    return true;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
                    return false;
                }
            }
            return false;
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ö–æ–¥–∞
        function sendMove(from, to, piece) {
            const move = {
                type: 'tcp_move',
                sessionId: sessionId,
                from: from,
                to: to,
                piece: piece,
                timestamp: new Date().toISOString()
            };

            if (sendMessage(move)) {
                showNotification(`–•–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω: ${from} ‚Üí ${to}`, 'success');
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message || !isConnected) return;

            const chatMessage = {
                type: 'chat',
                sessionId: sessionId,
                message: message,
                timestamp: new Date().toISOString()
            };

            if (sendMessage(chatMessage)) {
                input.value = '';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        function handleMessage(data) {
            try {
                const message = JSON.parse(data);
                
                switch (message.type) {
                    case 'move':
                        if (message.player && message.move) {
                            handleRemoteMove(message.player, message.move);
                        }
                        break;
                    case 'chat':
                        if (message.player && message.message) {
                            addChatMessage(message.player, message.message, 'user');
                        }
                        break;
                    case 'event':
                        if (message.message) {
                            addChatMessage('–°–æ–±—ã—Ç–∏–µ', message.message, 'event');
                        }
                        break;
                }
            } catch (error) {
                // –ü—Ä–æ—Å—Ç–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                addChatMessage('–°–µ—Ä–≤–µ—Ä', data, 'system');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ö–æ–¥–∞ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        function handleRemoteMove(player, move) {
            if (move.sessionId === sessionId) return; // –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–≤–æ–∏ —Ö–æ–¥—ã

            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å–∫—É
            gameBoard[move.to] = gameBoard[move.from] || '‚ôü';
            delete gameBoard[move.from];

            document.getElementById(move.from).textContent = '';
            document.getElementById(move.to).textContent = gameBoard[move.to];

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            addMoveToHistory(player, move.from, move.to, move.piece);
            
            showNotification(`${player} —Å–¥–µ–ª–∞–ª —Ö–æ–¥: ${move.from} ‚Üí ${move.to}`, 'info');
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ö–æ–¥–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é
        function addMoveToHistory(player, from, to, piece) {
            const movesList = document.getElementById('movesList');
            const moveDiv = document.createElement('div');
            moveDiv.className = 'move-item';
            
            const timestamp = new Date().toLocaleTimeString();
            moveDiv.innerHTML = `
                <strong>${escapeHtml(player)}:</strong> ${piece} ${from} ‚Üí ${to}
                <small style="color: #666;">${timestamp}</small>
            `;
            
            movesList.appendChild(moveDiv);
            movesList.scrollTop = movesList.scrollHeight;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function addChatMessage(sender, message, type = 'user') {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            messageDiv.innerHTML = `
                <strong>${escapeHtml(sender)}:</strong> ${escapeHtml(message)}
                <small style="float: right; color: #666;">${timestamp}</small>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ —á–∞—Ç–µ
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            chatInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    sendChatMessage();
                }
            });
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à–∞—Ö–º–∞—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞...');
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–µ—Å—Å–∏–∏
            sessionId = generateSessionId();
            console.log('üìã Session ID:', sessionId);
            
            // –°–æ–∑–¥–∞–µ–º —à–∞—Ö–º–∞—Ç–Ω—É—é –¥–æ—Å–∫—É
            createChessBoard();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
            setupInitialPosition();
            
            console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        });

        console.log('‚úÖ –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ');
    </script>
</body>
</html>